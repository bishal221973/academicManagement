import{d as f,y as h,T as cs,K as k,q as ms,o as c,e as m,b,w as N,F as g,a as e,t as d,h as v,c as fs,g as J,n as Q,u as a,p as bs,k as B,v as S,f as X,i as ps}from"./app-91f7f415.js";import{_ as xs}from"./AppLayout-971202a1.js";import{B as gs}from"./Breadcrumb-625ba3d5.js";import{_ as vs}from"./AddRoom-0314431d.js";import{_ as ys}from"./Modal-dd194025.js";import{c as _s,D as ws,T as hs}from"./AddStudent-b7b549a9.js";import{_ as ks}from"./SelectStudent1-744dcd79.js";import{_ as Ns}from"./_plugin-vue_export-helper-c27b6911.js";import"./printer-74c671e9.js";import"./AddHostel-4abbb802.js";const Bs={class:"flex items-center justify-between mb-3"},Ss={class:"flex w-full gap-3"},Vs={class:"w-full"},Rs={class:"rounded-lg shadow p-3 bg-white"},js={class:"flex flex-wrap gap-2 text-sm text-gray-600"},Ts={class:"font-semibold text-gray-800"},Cs={class:"flex mt-2 gap-3"},Is={class:"rounded-lg shadow bg-white left-box"},Ds={class:"p-3"},As={class:"space-y-1"},Us={class:"w-full bg-white rounded-md p-3"},$s={class:"flex gap-3"},Fs={class:"text-gray-500"},Hs={class:"text-gray-500"},Ms={class:"text-gray-500"},Ps={class:"text-gray-500"},Os={class:"text-gray-500"},Es={class:"grid grid-cols-12 gap-3"},Ls={class:"w-full"},qs={class:"block text-center"},zs={key:0,class:"flex justify-center"},Gs={key:1,class:"flex justify-center"},Ks=["onClick"],Ws={class:"flex gap-3"},Js={class:"w-full"},Qs={class:"mb-1"},Xs={class:"mb-1"},Ys={class:"mb-1"},Zs={class:"text-red-600"},se={class:"mb-1"},ee={class:"text-red-600"},te={class:"mb-1"},le={class:"text-red-600"},oe={class:"w-[500px]"},ne={class:"bg-gray-100 p-3 rounded"},ae={class:"flex justify-between"},de={class:"block mt-3"},ie={class:"flex items-center justify-between gap-3"},re={class:"flex items-center"},ue={key:0,class:"my-2"},ce={key:1,class:"flex justify-between"},me={class:"flex justify-between"},fe={class:"flex justify-between mb-1"},be={class:"flex items-center gap-3"},pe=["checked","onChange"],xe={class:"flex justify-between"},ge={__name:"HostelShow",props:{hostel:Object,room:Object,hostelStudents:Object,studentsInRoom:Object},setup(i){var D,A,U,$,F,H;const n=i,Y=f((D=n==null?void 0:n.hostel)==null?void 0:D.rooms),V=async(l=null)=>{const s=await axios.get(route("room.all"),{params:{hostel_id:l||""}});Y.value=s.data.rooms};h(()=>{V(),Pusher.logToConsole=!0,new Pusher("09a7a9ef059d4f63aa24",{cluster:"ap2"}).subscribe("my-channel").bind("hostel-room-event",()=>{V()})});const R=f(null);h(()=>{const l=new URLSearchParams(window.location.search);R.value=l.get("room_id")});const y=f(!1),Z=f(null),_=(l=null)=>{y.value=!y.value,Z.value=l,t.bed_no="Bed No. "+l},t=cs({hostel_id:((A=n==null?void 0:n.hostel)==null?void 0:A.id)??"",course_id:"",student_id:"",room_id:((U=n==null?void 0:n.room)==null?void 0:U.id)??"",price:(($=n==null?void 0:n.room)==null?void 0:$.price)??"0",check_in_date:"",bed_no:"",stay_month:"1",taxes:[],is_percentage:!1,discount:0,net_total:((F=n==null?void 0:n.room)==null?void 0:F.price)??"0",total_amount:((H=n==null?void 0:n.room)==null?void 0:H.price)??"0"}),x=f(0),ss=f(0),j=f(0);k(t.price,()=>{ss.value=t.price,j.value=t.price});const es=()=>{if(t.is_percentage)if(t.price>0){const l=t.price*t.discount/100;x.value=l.toFixed(2)}else x.value="0.0";else x.value=Number(t.discount).toFixed(2);ts(t.price,x.value)};k([()=>t.is_percentage,()=>t.discount],()=>{es()});const ts=(l,s)=>{const r=Number(l)-Number(s);j.value=Number(r).toFixed(2),t.net_total=r,C(r)},T=f(0),C=l=>{let s=0;for(const o of t.taxes){const p=Number(l)*(o.percentage/100);s+=p}const r=Number(l)+Number(s);T.value=r,t.total_amount=r},ls=()=>{os()},os=async()=>{t.post(route("hostelStudent.store"),{onSuccess:()=>{t.reset(),_()}})},ns=ms(()=>!n.room||!n.hostelStudents?[]:n.hostelStudents.filter(l=>l.room_id===n.room.id).map(l=>Number(l.bed_no.replace("Bed No. ",""))));k(()=>t.stay_month,l=>{var s;l>=1&&(t.price=((s=n==null?void 0:n.room)==null?void 0:s.price)*l)}),h(()=>{as()});const I=f([]),as=async()=>{const l=await axios.get(route("tax.all"));I.value=l.data.taxes},ds=l=>t.taxes.some(s=>s.tax_id===l.id),is=l=>{const s=t.taxes.findIndex(r=>r.tax_id===l.id);s===-1?t.taxes.push({tax_id:l.id,name:l.name,percentage:l.percentage}):t.taxes.splice(s,1),C(t.net_total)},rs=(l,s)=>l*s/100;return(l,s)=>(c(),m(g,null,[b(xs,null,{content:N(()=>{var r,o,p,w,M,P,O,E,L,q,z,G,K,W;return[e("div",Bs,[b(gs,{breadcrumbs:[{label:"Hostel Management"},{label:"Hostel"},{label:"Show"}]})]),e("div",Ss,[e("div",Vs,[e("div",Rs,[e("div",js,[e("span",Ts,d((r=i.hostel)==null?void 0:r.name),1),s[7]||(s[7]=e("span",null,"|",-1)),e("span",null,d((o=i.hostel)==null?void 0:o.address),1),s[8]||(s[8]=e("span",null,"|",-1)),e("span",null,d((w=(p=i.hostel)==null?void 0:p.rooms)==null?void 0:w.length)+" Rooms",1),s[9]||(s[9]=e("span",null,"|",-1)),e("span",null,d((M=i.studentsInRoom)==null?void 0:M.length)+" Students",1)])]),e("div",Cs,[e("div",Is,[e("div",Ds,[s[10]||(s[10]=e("small",{class:"block text-center font-semibold text-gray-700"},"Rooms",-1)),s[11]||(s[11]=e("hr",{class:"my-2 border-gray-200"},null,-1)),e("div",As,[(c(!0),m(g,null,v((P=i.hostel)==null?void 0:P.rooms,u=>(c(),fs(a(bs),{key:u.id,href:l.route("hostel.show",i.hostel.id)+"?room_id="+((u==null?void 0:u.id)??""),class:Q([R.value==u.id?"bg-red-500 text-white":"","block w-full text-[12px] px-3 py-2 rounded border border-gray-300 hover:border-gray-500 text-left transition-all"]),onClick:us=>l.switchRoom(u.id)},{default:N(()=>[J(d(u==null?void 0:u.name),1)]),_:2},1032,["href","class","onClick"]))),128)),b(vs,{type:"type1",hostelId:(O=i.hostel)==null?void 0:O.id},null,8,["hostelId"])])])]),e("div",Us,[e("div",$s,[e("small",null,[s[12]||(s[12]=e("span",{class:"font-bold"},"Name : ",-1)),e("span",Fs,d((E=i.room)==null?void 0:E.name),1)]),s[17]||(s[17]=e("span",{class:"relative -mt-[3px]"},"|",-1)),e("small",null,[s[13]||(s[13]=e("span",{class:"font-bold"},"No. of Bed : ",-1)),e("span",Hs,d((L=i.room)==null?void 0:L.no_of_bed),1)]),s[18]||(s[18]=e("span",{class:"relative -mt-[3px]"},"|",-1)),e("small",null,[s[14]||(s[14]=e("span",{class:"font-bold"},"No. of Students : ",-1)),e("span",Ms,d((q=i.studentsInRoom)==null?void 0:q.length),1)]),s[19]||(s[19]=e("span",{class:"relative -mt-[3px]"},"|",-1)),e("small",null,[s[15]||(s[15]=e("span",{class:"font-bold"},"No. of Free Bed : ",-1)),e("span",Ps,d(((z=i.room)==null?void 0:z.no_of_bed)-((G=i.studentsInRoom)==null?void 0:G.length)),1)]),s[20]||(s[20]=e("span",{class:"relative -mt-[3px]"},"|",-1)),e("small",null,[s[16]||(s[16]=e("span",{class:"font-bold"},"Price : ",-1)),e("span",Os," Rs. "+d((K=i.room)==null?void 0:K.price),1)])]),s[23]||(s[23]=e("hr",{class:"my-3"},null,-1)),e("div",Es,[(c(!0),m(g,null,v(Number(((W=i.room)==null?void 0:W.no_of_bed)||0),u=>(c(),m("div",{key:u,class:"col-span-2"},[e("div",Ls,[s[22]||(s[22]=e("div",{class:"flex justify-center"},[e("img",{class:"w-[40px]",src:"/bed.png",alt:""})],-1)),e("small",qs,"Bed No. "+d(u),1),ns.value.includes(u)?(c(),m("div",zs,[...s[21]||(s[21]=[e("small",{class:"block text-center bg-red-200 rounded-lg text-[9px] text-red-500 w-[50px]"},"Booked",-1)])])):(c(),m("div",Gs,[e("button",{onClick:us=>_(u),class:"block text-center bg-green-100 rounded-lg text-[9px] text-green-500 w-[50px]"},"Book now",8,Ks)]))])]))),128))])])])])])]}),_:1}),b(ys,{title:"Book Room",maxWidth:"xl",onClose:_,show:y.value},{default:N(()=>{var r;return[e("form",{onSubmit:ps(ls,["prevent"])},[e("div",Ws,[e("div",Js,[e("div",Qs,[s[24]||(s[24]=e("label",{class:"text-[14px]"},"Course*",-1)),b(_s,{modelValue:a(t).course_id,"onUpdate:modelValue":s[0]||(s[0]=o=>a(t).course_id=o)},null,8,["modelValue"])]),e("div",Xs,[s[25]||(s[25]=e("label",{class:"text-[14px]"},"Student*",-1)),b(ks,{modelValue:a(t).student_id,"onUpdate:modelValue":s[1]||(s[1]=o=>a(t).student_id=o),courseId:a(t).course_id},null,8,["modelValue","courseId"])]),e("div",Ys,[s[26]||(s[26]=e("label",{class:"text-[14px]"},"Checkin Date *",-1)),b(ws,{modelValue:a(t).check_in_date,"onUpdate:modelValue":s[2]||(s[2]=o=>a(t).check_in_date=o)},null,8,["modelValue"]),e("small",Zs,d(a(t).errors.check_in_date),1)]),e("div",se,[s[27]||(s[27]=e("label",{class:"text-[14px]"},"Bed *",-1)),B(e("input",{type:"text","onUpdate:modelValue":s[3]||(s[3]=o=>a(t).bed_no=o),class:"w-full border border-gray-300 rounded px-3 py-2 mt-1 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter price"},null,512),[[S,a(t).bed_no]]),e("small",ee,d(a(t).errors.bed_no),1)]),e("div",te,[s[28]||(s[28]=e("label",{class:"text-[14px]"},"Stay Month *",-1)),B(e("input",{type:"number",step:"1",min:1,"onUpdate:modelValue":s[4]||(s[4]=o=>a(t).stay_month=o),class:"w-full border border-gray-300 rounded px-3 py-2 mt-1 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter price"},null,512),[[S,a(t).stay_month]]),e("small",le,d(a(t).errors.stay_month),1)]),s[29]||(s[29]=e("div",{class:"flex justify-end"},[e("button",{class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",type:"submit"},d("Book Now"))],-1))]),e("div",oe,[e("div",ne,[e("div",ae,[s[30]||(s[30]=e("small",{class:"font-bold"},"Sub Total : ",-1)),e("small",null,"Rs. "+d(a(t).price),1)]),s[37]||(s[37]=e("hr",{class:"my-2"},null,-1)),e("div",de,[e("div",ie,[s[33]||(s[33]=e("label",{for:""},"Discount",-1)),e("div",re,[s[31]||(s[31]=e("small",{class:"block mr-1"},"रु",-1)),b(hs,{modelValue:a(t).is_percentage,"onUpdate:modelValue":s[5]||(s[5]=o=>a(t).is_percentage=o),onColor:"#fff",offColor:"#ccc",class:"relative top-[2px]"},null,8,["modelValue"]),s[32]||(s[32]=e("small",{class:"block pl-3",style:{"padding-left":"25px"}},"%",-1))])]),B(e("input",{type:"text","onUpdate:modelValue":s[6]||(s[6]=o=>a(t).discount=o),class:Q([(r=l.student)!=null&&r.id?"pointer-events-none bg-gray-100":"","w-full border border-gray-300 rounded px-3 py-2 mt-1 focus:outline-none focus:ring-2 focus:ring-blue-500"]),placeholder:"Discounts"},null,2),[[S,a(t).discount]])]),a(t).is_percentage?(c(),m("hr",ue)):X("",!0),a(t).is_percentage?(c(),m("div",ce,[s[34]||(s[34]=e("small",{class:"font-bold"},"Discount Amount : ",-1)),e("small",null,"Rs. "+d(x.value),1)])):X("",!0),s[38]||(s[38]=e("hr",{class:"my-2"},null,-1)),e("div",me,[s[35]||(s[35]=e("small",{class:"font-bold"},"Net Total : ",-1)),e("small",null,"Rs. "+d(a(t).net_total),1)]),s[39]||(s[39]=e("hr",{class:"my-2"},null,-1)),(c(!0),m(g,null,v(I.value,(o,p)=>(c(),m("div",fe,[e("div",be,[e("input",{type:"checkbox",checked:ds(o),onChange:w=>is(o),name:"",id:""},null,40,pe),J(" "+d(o==null?void 0:o.name),1)]),e("div",null,d(o==null?void 0:o.percentage)+"% ",1)]))),256)),s[40]||(s[40]=e("hr",{class:"my-2"},null,-1)),s[41]||(s[41]=e("div",null,[e("small",null,[e("b",null,"Taxes")])],-1)),(c(!0),m(g,null,v(a(t).taxes,(o,p)=>(c(),m("div",{class:"flex justify-between",key:p},[e("small",null,d(o==null?void 0:o.name)+" ("+d(o==null?void 0:o.percentage)+"%) ",1),e("small",null," Rs. "+d(rs(a(t).net_total,o.percentage)),1)]))),128)),s[42]||(s[42]=e("hr",{class:"my-2"},null,-1)),e("div",xe,[s[36]||(s[36]=e("small",{class:"font-bold"},"Grand Total : ",-1)),e("small",null,"Rs. "+d(T.value),1)])])])])],32)]}),_:1},8,["show"])],64))}},Re=Ns(ge,[["__scopeId","data-v-0c197fa5"]]);export{Re as default};
