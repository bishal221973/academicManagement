import{_ as re}from"./AppLayout-8c26fc8d.js";import{d as f,x as N,q as O,y as w,o as b,e as v,b as h,T as K,L as T,a as s,w as Q,i as de,k as R,u as a,v as j,t as c,g as F,F as $,h as D,n as ue,f as J,c as ie}from"./app-57419d0c.js";import{_ as ce}from"./Modal-98fe17cf.js";import{S as me,D as pe,T as _e}from"./AddStudent-2b33b2a0.js";import{_ as fe}from"./_plugin-vue_export-helper-c27b6911.js";import{B as be}from"./Breadcrumb-74eda663.js";import{T as he}from"./Table-df6073c3.js";import{_ as ge}from"./SelectStudent1-6f83790d.js";import{_ as ve,a as xe}from"./AddRoom-1e13734b.js";import"./printer-8ef20624.js";import"./ExportPrint-1535eb17.js";/* empty css                                                                    *//* empty css                                                              */import"./AddHostel-d479c191.js";const ye={class:"w-full border-[1px] border-gray-300 rounded-md flex px-3"},ke={__name:"SelectHostelRoom",props:{modelValue:[String,Number],hostelId:[String,Number],lastRoom:[String,Number]},emits:["update:modelValue"],setup(m,{emit:n}){const x=m,S=n,p=f([]),r=async(t=null)=>{const i=await axios.get(route("room.all"),{params:{hostel_id:t??(x==null?void 0:x.hostelId)??""}});p.value=i.data.rooms};N(()=>{r(),Pusher.logToConsole=!0;var t=new Pusher("09a7a9ef059d4f63aa24",{cluster:"ap2"});t.subscribe("my-channel").bind("hostel-room-event",()=>{r()})});const y=t=>t&&t.length>0?t.map(i=>({label:i==null?void 0:i.name,value:i.id})):[],k=O(()=>y(p.value));return w(()=>x.hostelId,t=>{r(t),S("update:modelValue",null)},{immediate:!0}),w(()=>x.lastRoom,t=>{S("update:modelValue",t)},{immediate:!0}),(t,i)=>(b(),v("div",ye,[h(me,{options:k.value,label:"Date Format *",placeholder:"Select student",isForm:!0,"onUpdate:modelValue":i[0]||(i[0]=V=>S("update:modelValue",V)),modelValue:m.modelValue},null,8,["options","modelValue"]),h(ve,{isSelect:!0})]))}},we={class:"flex gap-3"},Se={class:"w-full"},Ve={class:"grid grid-cols-12 gap-3"},Ne={class:"col-span-5"},Re={class:"text-red-600"},je={class:"col-span-5"},Te={class:"col-span-5"},Ce={class:"text-red-600"},Ae={class:"col-span-5"},$e={class:"text-red-600"},Be={class:"col-span-12"},Fe={class:"col-span-4"},De={class:"col-span-4"},Oe={class:"text-[14px]"},Ue={class:"text-red-600"},Ie={class:"col-span-4"},Pe={class:"text-red-600"},Me={class:"flex justify-between"},Ee={class:"flex items-center gap-3"},Le=["checked","onChange"],He={class:"w-[400px]"},qe={class:"bg-gray-100 p-3 rounded"},ze={class:"flex justify-between"},Ge={class:"block mt-3"},We={class:"flex items-center justify-between gap-3"},Je={class:"flex items-center"},Ke={key:0,class:"my-2"},Qe={key:1,class:"flex justify-between"},Xe={class:"flex justify-between"},Ye={class:"flex justify-between mb-1"},Ze={class:"flex items-center gap-3"},et=["checked","onChange"],tt={class:"flex justify-between"},st={class:"flex justify-end bg-gray-100 rounded p-3 mt-3"},ot={class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700",type:"submit"},lt={__name:"HostelBooking",props:{hostel:Object,room:Object,hostelStudents:Object,studentsInRoom:Object,features:Object,student:Object,myFeatures:Object},setup(m){var q,z,G,W;const n=m,x=f((q=n==null?void 0:n.hostel)==null?void 0:q.rooms),S=async(o=null)=>{const e=await T.get(route("room.all"),{params:{hostel_id:o||""}});x.value=e.data.rooms};N(()=>{S(),Pusher.logToConsole=!0,new Pusher("09a7a9ef059d4f63aa24",{cluster:"ap2"}).subscribe("my-channel").bind("hostel-room-event",()=>{S()})});const p=f(null);N(()=>{const o=new URLSearchParams(window.location.search);p.value=o.get("room_id")});const r=f(!1),y=f(null),k=(o=null)=>{r.value=!r.value,y.value=o,t.bed_no="Bed No. "+o},t=K({contact:"",course_id:"",student_id:"",student_name:"",roll_no:"",reg_no:"",hostel_id:"",room_id:3,price:((z=n==null?void 0:n.room)==null?void 0:z.price)??"0",check_in_date:"",stay_month:"1",taxes:[],features:[],is_percentage:!1,discount:0,net_total:((G=n==null?void 0:n.room)==null?void 0:G.price)??"0",total_amount:((W=n==null?void 0:n.room)==null?void 0:W.price)??"0"}),i=f(0),V=f(0),U=f(0);w(t.price,()=>{V.value=t.price,U.value=t.price});const I=f(null);N(()=>{var o,e,d,_;if(n.myFeatures&&(t.features=(e=(o=n.myFeatures)==null?void 0:o.features)==null?void 0:e.map(u=>{var g,l;return{feature_id:u.hostel_feature_id,name:(g=u.feature)==null?void 0:g.title,price:(l=u.feature)==null?void 0:l.price}}),C()),(d=n==null?void 0:n.student)!=null&&d.id){k(),t.contact=(_=n.student)==null?void 0:_.phone;const u=Array.isArray(n.student.hostels)?n.student.hostels.at(-1):null;u!=null&&u.room_id&&(t.room_id=Number(u.room_id),t.hostel_id=Number(u.hostel_id),I.value=Number(u==null?void 0:u.room_id))}});const X=()=>{if(t.is_percentage)if(t.price>0){const o=t.price*t.discount/100;i.value=o.toFixed(2)}else i.value="0.0";else i.value=Number(t.discount).toFixed(2);P(t.price,i.value)};w([()=>t.is_percentage,()=>t.discount],()=>{X()});const P=(o,e)=>{const d=Number(o)-Number(e);U.value=Number(d).toFixed(2),t.net_total=d,E(d)},M=f(0),E=o=>{let e=0;for(const _ of t.taxes){const u=Number(o)*(_.percentage/100);e+=u}const d=Number(o)+Number(e);M.value=d,t.total_amount=d},Y=()=>{Z()},Z=async()=>{t.post(route("hostelStudent.store"),{onSuccess:()=>{t.reset(),k()}})};O(()=>!n.room||!n.hostelStudents?[]:n.hostelStudents.filter(o=>o.room_id===n.room.id).map(o=>Number(o.bed_no.replace("Bed No. ",""))));const B=f(0);f(0),w(()=>t.stay_month,o=>{o>=1&&(t.price=B.value*o)}),N(()=>{ee()});const L=f([]),ee=async()=>{const o=await T.get(route("tax.all"));L.value=o.data.taxes},H=o=>{var e;return(e=t.features)==null?void 0:e.some(d=>d.feature_id===o.id)},te=o=>{const e=t.taxes.findIndex(d=>d.tax_id===o.id);e===-1?t.taxes.push({tax_id:o.id,name:o.name,percentage:o.percentage}):t.taxes.splice(e,1),E(t.net_total)},se=o=>{Array.isArray(t.features)||(t.features=[]);const e=t.features.findIndex(d=>d.feature_id===o.id);e===-1?t.features.push({feature_id:o.id,name:o.title,price:o.price}):t.features.splice(e,1),C()},oe=(o,e)=>o*e/100,C=()=>{const o=B.value??0,e=t.stay_month??1,d=(t.features||[]).reduce((u,g)=>u+Number(g.price||0),0),_=o*e+d;t.price=_,P(t.price,i.value)};w(()=>t.contact,()=>{le()}),w(()=>t.room_id,()=>{ne()});const le=async()=>{var e,d,_,u,g;const o=await T.get(route("student.find")+"?contact="+t.contact);t.course_id=(e=o.data)==null?void 0:e.course_id,t.student_id=(d=o.data)==null?void 0:d.id,t.student_name=(_=o.data)==null?void 0:_.name,t.roll_no=(u=o.data)==null?void 0:u.roll_number,t.reg_no=(g=o.data)==null?void 0:g.registration_number},ne=async()=>{var e;const o=await T.get(route("room.find")+"?id="+t.room_id);t.price=(e=o.data)==null?void 0:e.price,B.value=o.data.price,C()};return w(()=>t.stay_month,()=>{C()}),(o,e)=>{var d;return b(),v($,null,[s("button",{onClick:e[0]||(e[0]=_=>k(o.n)),class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"},"Book now"),h(ce,{title:(d=m.student)!=null&&d.id?"Renew Now":"Book Room",maxWidth:"4xl",onClose:k,show:r.value},{default:Q(()=>{var _,u,g;return[s("form",{onSubmit:de(Y,["prevent"])},[s("div",we,[s("div",Se,[s("div",Ve,[s("div",Ne,[e[11]||(e[11]=s("label",{class:"text-[14px]"},"Mobile / Email *",-1)),R(s("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=l=>a(t).contact=l),class:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter mobile number or emial address"},null,512),[[j,a(t).contact]]),s("small",Re,c(a(t).errors.bed_no),1)]),s("div",je,[F(c(a(t).student_name)+" ",1),e[12]||(e[12]=s("label",{class:"text-[14px]"},"Student*",-1)),h(ge,{modelValue:a(t).student_id,"onUpdate:modelValue":e[2]||(e[2]=l=>a(t).student_id=l),courseId:a(t).course_id},null,8,["modelValue","courseId"])]),e[18]||(e[18]=s("div",{class:"col-span-2 row-span-2"},[s("div",{class:"border-[1px] h-full rounded-md p-3 flex justify-center items-center"},[s("img",{src:"/student.png",class:"h-full",alt:""})])],-1)),s("div",Te,[e[13]||(e[13]=s("label",{class:"text-[14px]"},"Roll No. *",-1)),R(s("input",{type:"number",step:"1",min:1,"onUpdate:modelValue":e[3]||(e[3]=l=>a(t).roll_no=l),class:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter price"},null,512),[[j,a(t).roll_no]]),s("small",Ce,c(a(t).errors.roll_no),1)]),s("div",Ae,[e[14]||(e[14]=s("label",{class:"text-[14px]"},"Reg. No *",-1)),R(s("input",{type:"text",step:"1",min:1,"onUpdate:modelValue":e[4]||(e[4]=l=>a(t).reg_no=l),class:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter price"},null,512),[[j,a(t).reg_no]]),s("small",$e,c(a(t).errors.reg_no),1)]),e[19]||(e[19]=s("div",{class:"col-span-12"},[s("hr")],-1)),s("div",Be,[e[15]||(e[15]=s("label",{class:"text-[14px]"},"Hostel*",-1)),h(xe,{modelValue:a(t).hostel_id,"onUpdate:modelValue":e[5]||(e[5]=l=>a(t).hostel_id=l)},null,8,["modelValue"])]),s("div",Fe,[e[16]||(e[16]=s("label",{class:"text-[14px]"},"Room*",-1)),h(ke,{lastRoom:I.value,modelValue:a(t).room_id,"onUpdate:modelValue":e[6]||(e[6]=l=>a(t).room_id=l),hostelId:a(t).hostel_id},null,8,["lastRoom","modelValue","hostelId"])]),s("div",De,[s("label",Oe,c((_=m.student)!=null&&_.id?"Renew":"Checkin")+" Date *",1),h(pe,{modelValue:a(t).check_in_date,"onUpdate:modelValue":e[7]||(e[7]=l=>a(t).check_in_date=l),class:"-mt-1"},null,8,["modelValue"]),s("small",Ue,c(a(t).errors.check_in_date),1)]),s("div",Ie,[e[17]||(e[17]=s("label",{class:"text-[14px]"},"Stay Month *",-1)),R(s("input",{type:"number",step:"1",min:1,"onUpdate:modelValue":e[8]||(e[8]=l=>a(t).stay_month=l),class:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter price"},null,512),[[j,a(t).stay_month]]),s("small",Pe,c(a(t).errors.stay_month),1)]),e[20]||(e[20]=s("div",{class:"col-span-12"},[s("hr")],-1)),e[21]||(e[21]=s("div",{class:"col-span-12"},[s("span",null,"Services")],-1)),(b(!0),v($,null,D(m.features,(l,A)=>(b(),v("div",{class:"col-span-4 -mt-3",key:A},[s("div",Me,[s("div",Ee,[s("input",{type:"checkbox",class:"rounded-xl",checked:H(l),onChange:ae=>se(l),name:"",id:""},null,40,Le),F(" "+c(l==null?void 0:l.title)+" ",1),s("small",null,"(Rs. "+c(l==null?void 0:l.price)+")",1)])])]))),128))])]),s("div",He,[s("div",qe,[s("div",ze,[e[22]||(e[22]=s("small",{class:"font-bold"},"Sub Total : ",-1)),s("small",null,"Rs. "+c(a(t).price),1)]),e[29]||(e[29]=s("hr",{class:"my-2"},null,-1)),s("div",Ge,[s("div",We,[e[25]||(e[25]=s("label",{for:""},"Discount",-1)),s("div",Je,[e[23]||(e[23]=s("small",{class:"block mr-1"},"रु",-1)),h(_e,{modelValue:a(t).is_percentage,"onUpdate:modelValue":e[9]||(e[9]=l=>a(t).is_percentage=l),onColor:"#fff",offColor:"#ccc",class:"relative top-[2px]"},null,8,["modelValue"]),e[24]||(e[24]=s("small",{class:"block pl-3",style:{"padding-left":"25px"}},"%",-1))])]),R(s("input",{type:"text","onUpdate:modelValue":e[10]||(e[10]=l=>a(t).discount=l),class:ue([(u=m.student)!=null&&u.id?"pointer-events-none bg-gray-100":"","w-full border border-gray-300 rounded px-3 py-2 mt-1 focus:outline-none focus:ring-2 focus:ring-blue-500"]),placeholder:"Discounts"},null,2),[[j,a(t).discount]])]),a(t).is_percentage?(b(),v("hr",Ke)):J("",!0),a(t).is_percentage?(b(),v("div",Qe,[e[26]||(e[26]=s("small",{class:"font-bold"},"Discount Amount : ",-1)),s("small",null,"Rs. "+c(i.value),1)])):J("",!0),e[30]||(e[30]=s("hr",{class:"my-2"},null,-1)),s("div",Xe,[e[27]||(e[27]=s("small",{class:"font-bold"},"Net Total : ",-1)),s("small",null,"Rs. "+c(a(t).net_total),1)]),e[31]||(e[31]=s("hr",{class:"my-2"},null,-1)),(b(!0),v($,null,D(L.value,(l,A)=>(b(),v("div",Ye,[s("div",Ze,[s("input",{type:"checkbox",checked:H(l),onChange:ae=>te(l),name:"",id:""},null,40,et),F(" "+c(l==null?void 0:l.name),1)]),s("div",null,c(l==null?void 0:l.percentage)+"% ",1)]))),256)),e[32]||(e[32]=s("hr",{class:"my-2"},null,-1)),e[33]||(e[33]=s("div",null,[s("small",null,[s("b",null,"Taxes")])],-1)),(b(!0),v($,null,D(a(t).taxes,(l,A)=>(b(),v("div",{class:"flex justify-between",key:A},[s("small",null,c(l==null?void 0:l.name)+" ("+c(l==null?void 0:l.percentage)+"%) ",1),s("small",null," Rs. "+c(oe(a(t).net_total,l.percentage)),1)]))),128)),e[34]||(e[34]=s("hr",{class:"my-2"},null,-1)),s("div",tt,[e[28]||(e[28]=s("small",{class:"font-bold"},"Grand Total : ",-1)),s("small",null,"Rs. "+c(M.value),1)])])])]),s("div",st,[s("button",ot,c((g=m.student)!=null&&g.id?"Renew Now":"Book Now"),1)])],32)]}),_:1},8,["title","show"])],64)}}};const nt={class:"flex items-center justify-between mb-3"},at={class:"flex w-full gap-3"},rt={style:{width:"100%"}},dt={class:"grid grid-cols-12 gap-3"},ut={class:"col-span-12"},it={__name:"AddStudent",props:{rooms:Object,room:Object,hostelStudents:Object,hostelStudent:Object,features:Object,student:Object,myFeatures:Object},setup(m){const n=m,x=[{label:"S.N.",key:"sn"},{label:"Hostel Card No.",key:"view"},{label:"Hostel",key:"hostel"},{label:"Room",key:"room"},{label:"Student",key:"student"},{label:"Checkin",key:"checkin"},{label:"Checkout",key:"checkout"},{label:"Price",key:"price"},{label:"Actions",key:"actions"}],S=O(()=>n.hostelStudents.map((r,y)=>{var k,t,i,V;return{sn:y+1,view:(k=r==null?void 0:r.student)==null?void 0:k.hostel_id_number,url:route("student.show",r.student_id)+"?type=hostel",hostel:(t=r==null?void 0:r.hostel)==null?void 0:t.name,room:(i=r.room)==null?void 0:i.name,student:(V=r.student)==null?void 0:V.name,checkin:r.check_in_date,checkout:r.check_out_date,price:"Rs."+(r.price-(r==null?void 0:r.discount)),actions:r.id}})),p=K({hostel_id:"",course_id:"",student_id:"",room_id:"",price:"0",check_in_date:""});return N(()=>{var r,y;(r=n.hostelStudent)!=null&&r.id&&(p.hostel_id=n.hostelStudent.hostel_id,p.course_id=(y=n.hostelStudent.student)==null?void 0:y.course_id,p.student_id=n.hostelStudent.student_id,p.room_id=n.hostelStudent.room_id,p.price=n.hostelStudent.price,p.check_in_date=n.hostelStudent.check_in_date)}),w(()=>p.room_id,async()=>{const r=await T.get(route("room.show",p.room_id));p.price=r.data.room.price}),(r,y)=>(b(),ie(re,null,{content:Q(()=>[s("div",nt,[h(be,{breadcrumbs:[{label:"Hostel Management"},{label:"Booking Management"}]}),h(lt,{features:m.features,student:m.student,myFeatures:m.myFeatures},null,8,["features","student","myFeatures"])]),s("div",at,[s("div",rt,[s("div",dt,[s("div",ut,[h(he,{columns:x,data:S.value,exportTitle:"Student List",filters:r.filters,deleteUrl:"hostelStudent.delete"},null,8,["data","filters"])])])])])]),_:1}))}},Vt=fe(it,[["__scopeId","data-v-ff250905"]]);export{Vt as default};
